<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TexnoUsta API Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .endpoint {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .endpoint h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .get { background-color: #28a745; }
        .post { background-color: #007bff; }
        .put { background-color: #ffc107; color: black; }
        .delete { background-color: #dc3545; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .admin-btn {
            background: #dc3545;
        }
        .admin-btn:hover {
            background: #c82333;
        }
        textarea {
            width: 100%;
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        .auth-section {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
        }
        .admin-section {
            background: #ffe8e8;
            border-left: 4px solid #dc3545;
        }
        input[type="text"], input[type="email"], input[type="password"] {
            width: 200px;
            padding: 5px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .token-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            word-break: break-all;
            font-family: monospace;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>üõçÔ∏è TexnoUsta API Tester</h1>
    <p><strong>Base URL:</strong> http://localhost:8080/api/v1</p>

    <!-- –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="section">
        <h3>üîë –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
        <div id="tokenDisplay" class="token-display">–¢–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
        <button onclick="clearToken()">–û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
    </div>

    <div class="container">
        <!-- –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã -->
        <div class="section">
            <h3>üì± –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã</h3>
            
            <div class="endpoint auth-section">
                <h4><span class="method post">POST</span> –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞</h4>
                <input type="email" id="loginEmail" placeholder="Email" value="admin@texnousta.com">
                <input type="password" id="loginPassword" placeholder="Password" value="password">
                <br>
                <button onclick="login()">–í–æ–π—Ç–∏</button>
            </div>

            <div class="endpoint">
                <h4><span class="method get">GET</span> –¢–æ–≤–∞—Ä—ã</h4>
                <button onclick="getProducts()">–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</button>
                <button onclick="getFeaturedProducts()">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–æ–≤–∞—Ä—ã</button>
                <button onclick="getProduct(1)">–¢–æ–≤–∞—Ä #1</button>
            </div>

            <div class="endpoint">
                <h4><span class="method get">GET</span> –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h4>
                <button onclick="getCategories()">–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
            </div>

            <div class="endpoint">
                <h4><span class="method post">POST</span> –ë—ã—Å—Ç—Ä–∞—è –∑–∞—è–≤–∫–∞</h4>
                <input type="text" id="quickName" placeholder="–ò–º—è" value="–¢–µ—Å—Ç –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
                <input type="text" id="quickPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="">
                <br>
                <button onclick="quickContact()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>

            <div class="endpoint">
                <h4><span class="method post">POST</span> –ü–æ–ª–Ω–∞—è –∑–∞—è–≤–∫–∞</h4>
                <input type="text" id="fullName" placeholder="–ò–º—è" value="–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞"><br>
                <input type="email" id="fullEmail" placeholder="Email" value="maria@test.com"><br>
                <input type="text" id="fullPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="+998901234568"><br>
                <input type="text" id="fullSubject" placeholder="–¢–µ–º–∞" value="–í–æ–ø—Ä–æ—Å –æ —Ç–æ–≤–∞—Ä–µ"><br>
                <button onclick="fullContact()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>

        <!-- –ê–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã -->
        <div class="section admin-section">
            <h3>üîí –ê–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã</h3>
            
            <div class="endpoint">
                <h4><span class="method get">GET</span> –ü—Ä–æ—Ñ–∏–ª—å</h4>
                <button class="admin-btn" onclick="getProfile()">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>
            </div>

            <div class="endpoint">
                <h4><span class="method get">GET</span> –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è</h4>
                <button class="admin-btn" onclick="getContacts()">–í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è</button>
                <button class="admin-btn" onclick="getUnreadContacts()">–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</button>
            </div>

            <div class="endpoint">
                <h4><span class="method post">POST</span> –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä</h4>
                <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value="–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä"><br>
                <input type="text" id="productPrice" placeholder="–¶–µ–Ω–∞" value="999"><br>
                <button class="admin-btn" onclick="createProduct()">–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>

            <div class="endpoint">
                <h4><span class="method post">POST</span> –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h4>
                <input type="text" id="categoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value="–¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"><br>
                <button class="admin-btn" onclick="createCategory()">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
            </div>

            <div class="endpoint">
                <h4><span class="method get">GET</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h4>
                <button class="admin-btn" onclick="getUsers()">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            </div>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div class="section">
        <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
        <textarea id="results" placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å..."></textarea>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        let authToken = localStorage.getItem('authToken') || '';

        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
        function updateTokenDisplay() {
            const display = document.getElementById('tokenDisplay');
            if (authToken) {
                display.innerHTML = `<strong>–¢–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:</strong><br>${authToken.substring(0, 50)}...`;
                display.style.backgroundColor = '#d4edda';
            } else {
                display.innerHTML = '–¢–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                display.style.backgroundColor = '#f8f9fa';
            }
        }

        // –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω
        function clearToken() {
            authToken = '';
            localStorage.removeItem('authToken');
            updateTokenDisplay();
            logResult('–¢–æ–∫–µ–Ω –æ—á–∏—â–µ–Ω');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateTokenDisplay();

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function logResult(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.value = `[${timestamp}] ${message}\n\n${results.value}`;
        }

        // –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
        async function makeRequest(method, endpoint, data = null, requiresAuth = false) {
            const headers = {
                'Content-Type': 'application/json'
            };

            if (requiresAuth && authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            const config = {
                method,
                headers
            };

            if (data) {
                config.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, config);
                const result = await response.json();
                
                const statusText = response.ok ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞';
                logResult(`${statusText} ${method} ${endpoint} (${response.status})\n${JSON.stringify(result, null, 2)}`);
                
                return result;
            } catch (error) {
                logResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ ${method} ${endpoint}\n${error.message}`);
                throw error;
            }
        }

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const result = await makeRequest('POST', '/login', { email, password });
            
            if (result.token) {
                authToken = result.token;
                localStorage.setItem('authToken', authToken);
                updateTokenDisplay();
            }
        }

        // –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
        async function getProducts() {
            await makeRequest('GET', '/products');
        }

        async function getFeaturedProducts() {
            await makeRequest('GET', '/products?featured=true&limit=5');
        }

        async function getProduct(id) {
            await makeRequest('GET', `/products/${id}`);
        }

        async function getCategories() {
            await makeRequest('GET', '/categories');
        }

        async function quickContact() {
            const name = document.getElementById('quickName').value;
            const phone = document.getElementById('quickPhone').value;
            await makeRequest('POST', '/quick-contact', { name, phone });
        }

        async function fullContact() {
            const data = {
                name: document.getElementById('fullName').value,
                email: document.getElementById('fullEmail').value,
                phone: document.getElementById('fullPhone').value,
                subject: document.getElementById('fullSubject').value,
                message: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–ø—Ä–æ—Å–µ'
            };
            await makeRequest('POST', '/contact', data);
        }

        // –ê–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
        async function getProfile() {
            await makeRequest('GET', '/profile', null, true);
        }

        async function getContacts() {
            await makeRequest('GET', '/admin/contacts', null, true);
        }

        async function getUnreadContacts() {
            await makeRequest('GET', '/admin/contacts?unread=true', null, true);
        }

        async function createProduct() {
            const data = {
                name: document.getElementById('productName').value,
                description: '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞',
                price: parseFloat(document.getElementById('productPrice').value),
                category_id: 1,
                brand: 'Test Brand',
                model: 'Test Model',
                stock: 10,
                is_active: true,
                is_featured: false
            };
            await makeRequest('POST', '/admin/products', data, true);
        }

        async function createCategory() {
            const data = {
                name: document.getElementById('categoryName').value,
                description: '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
                is_active: true
            };
            await makeRequest('POST', '/admin/categories', data, true);
        }

        async function getUsers() {
            await makeRequest('GET', '/admin/users', null, true);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
        async function runAllTests() {
            logResult('üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤...');
            
            // –¢–µ—Å—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
            await getProducts();
            await getCategories();
            await quickContact();
            
            // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            await login();
            
            // –¢–µ—Å—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
            await getProfile();
            await getContacts();
            
            logResult('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!');
        }

        // –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const button = document.createElement('button');
            button.textContent = 'üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã';
            button.style.backgroundColor = '#28a745';
            button.style.padding = '10px 20px';
            button.style.fontSize = '16px';
            button.onclick = runAllTests;
            
            const container = document.querySelector('h1');
            container.parentNode.insertBefore(button, container.nextSibling);
        });
    </script>
</body>
</html>